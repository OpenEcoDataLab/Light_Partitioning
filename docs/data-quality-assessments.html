<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Part 3 Data quality assessments | Light partitioning</title>
  <meta name="description" content="Part 3 Data quality assessments | Light partitioning" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Part 3 Data quality assessments | Light partitioning" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Part 3 Data quality assessments | Light partitioning" />
  
  
  

<meta name="author" content="Dr. Matthew Ross" />
<meta name="author" content="Dr. Jim Jawitz" />
<meta name="author" content="Dr. Matt Cohen" />


<meta name="date" content="2022-01-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="download-and-join.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="part"><span><b>I Motivation</b></span></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Tiny intro</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#workflow"><i class="fa fa-check"></i><b>1.1</b> Workflow</a></li>
</ul></li>
<li class="part"><span><b>II Data downloads and decisions</b></span></li>
<li class="chapter" data-level="2" data-path="download-and-join.html"><a href="download-and-join.html"><i class="fa fa-check"></i><b>2</b> Download and Join</a>
<ul>
<li class="chapter" data-level="2.1" data-path="download-and-join.html"><a href="download-and-join.html#aquasat-download"><i class="fa fa-check"></i><b>2.1</b> AquaSat download</a></li>
<li class="chapter" data-level="2.2" data-path="download-and-join.html"><a href="download-and-join.html#aquasat-read-and-join."><i class="fa fa-check"></i><b>2.2</b> AquaSat Read and join.</a></li>
<li class="chapter" data-level="2.3" data-path="download-and-join.html"><a href="download-and-join.html#data-eval-and-subset"><i class="fa fa-check"></i><b>2.3</b> Data Eval and Subset</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="download-and-join.html"><a href="download-and-join.html#selecting-only-simultaneous-observations"><i class="fa fa-check"></i><b>2.3.1</b> Selecting only simultaneous observations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="download-and-join.html"><a href="download-and-join.html#where-are-sites-with-simultaneous-observations-of-clarity-constituents"><i class="fa fa-check"></i><b>2.4</b> Where are sites with simultaneous observations of clarity constituents?</a></li>
<li class="chapter" data-level="2.5" data-path="download-and-join.html"><a href="download-and-join.html#what-is-the-general-relationiship-between-variables-in-log-log-space"><i class="fa fa-check"></i><b>2.5</b> What is the general relationiship between variables in log log space</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html"><i class="fa fa-check"></i><b>3</b> Data quality assessments</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#chl-a-to-biomass"><i class="fa fa-check"></i><b>3.1</b> Chl-a to biomass</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#approach"><i class="fa fa-check"></i><b>3.1.1</b> Approach</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#simple-evaluations-of-conversion"><i class="fa fa-check"></i><b>3.1.2</b> Simple evaluations of conversion</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#data-driven-qaqc"><i class="fa fa-check"></i><b>3.2</b> Data-driven qa/qc</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#extracting-methods"><i class="fa fa-check"></i><b>3.2.1</b> Extracting methods</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#light-attenuation-model-and-residuals"><i class="fa fa-check"></i><b>3.2.2</b> Light attenuation model and residuals</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#systematic-problems"><i class="fa fa-check"></i><b>3.2.3</b> Systematic problems?</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Light partitioning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-quality-assessments" class="section level1" number="3">
<h1><span class="header-section-number">Part 3</span> Data quality assessments</h1>
<p>Note, also eval = F to save computation time</p>
<div id="chl-a-to-biomass" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Chl-a to biomass</h2>
<p>While it is more common in coastal and oceanic research, inland water scientists
rarely measure water clarity constituents in the way that is most directly
transferable to our research question. Ideally we would routinely measure concentrations of
algae biomass, non-algal particles
(including inorganic sediment and organic sediment, I like to call this
stuff dead suspended sediment, but I guess NAP is fine), and dissolved organic
carbon. These constituents all alter light penetration in water, but they are
mutually exclusive groups with no measurement overlap between algal particles and NAP
for example. However, this is not what we usually measure. Instead, we have rich
datasets of things that could indicate our desired constituents. These map as basically.</p>
<ul>
<li>Chlorophyll-a -&gt; proxy for algae biomass.</li>
<li>Total suspended solids (tss) -&gt; All suspended solids, subtract algae biomass = NAP</li>
<li>DOC -&gt; DOC!</li>
</ul>
<p>That means we have to basically do one key calculation. Convert chl-a to biomass.
Then subtract that from tss and assume that is NAP. While this is a absurdly
simple calculation it is filled with dangers. The relationship between chl-a
and algae biomass depends on temperature and nutrients and species and is
<a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/2016GB005458">not universal</a>.
Most studies focus on Chl:C ratios, but we are interested in Chl:Biomass ratio,
for which there are much fewer studies, though some studies below suggest
a range of 0.005 to 0.1 Chl:biomass. (I need to find the C:Biomass study I used
forever ago.)</p>
<p>Papers that help:</p>
<p><a href="https://aslopubs.onlinelibrary.wiley.com/doi/full/10.1002/lno.10338" class="uri">https://aslopubs.onlinelibrary.wiley.com/doi/full/10.1002/lno.10338</a>
<a href="https://pubs.usgs.gov/twri/twri9a7/twri9a7_7.4.pdf" class="uri">https://pubs.usgs.gov/twri/twri9a7/twri9a7_7.4.pdf</a>
<a href="https://www.researchgate.net/publication/230056019_Relationship_between_Chlorophyll-a_Concentration_and_Phytoplankton_Biomass_in_Several_Reservoirs_in_Czechoslovakia/link/5cb56c164585156cd79af804/download" class="uri">https://www.researchgate.net/publication/230056019_Relationship_between_Chlorophyll-a_Concentration_and_Phytoplankton_Biomass_in_Several_Reservoirs_in_Czechoslovakia/link/5cb56c164585156cd79af804/download</a></p>
<div id="approach" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Approach</h3>
<p>Our philosphy here is that we will use chl-a directly as a proxy for algal biomass
to minimize the number of transformations to this data, since we are primarily
interested in how algae alters light attenuation, regardless of how we estimate algae.
However, we still need to calculate Non-Algal Particle mass. For that we will
use a range of values of Chl:biomass and show the impact of picking a variety
of ranges.</p>
<p><em>Caveats</em></p>
<ul>
<li><p>We don’t have a true NAP to compare how accurate our approach is.</p></li>
<li><p>We do have Inorganic Sediment, but that is not the same thing as non-algal
particles, since it excludes particulate organic carbon. Still, where
we have it, we will examine the relationship between NAP and TIS (total
inorganic sediment).</p></li>
<li><p>Not entirely sure how we propogate this uncertainty downstream? Pick an average?</p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-quality-assessments.html#cb11-1" aria-hidden="true" tabindex="-1"></a>in_vis <span class="ot">&lt;-</span> <span class="fu">read_feather</span>(<span class="st">&#39;data/out/simul.feather&#39;</span>)</span>
<span id="cb11-2"><a href="data-quality-assessments.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="data-quality-assessments.html#cb11-3" aria-hidden="true" tabindex="-1"></a>range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="fl">0.005</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">0.01</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">0.05</span>,<span class="dv">1</span><span class="sc">/</span><span class="fl">0.1</span>)</span>
<span id="cb11-4"><a href="data-quality-assessments.html#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="data-quality-assessments.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Couldn&#39;t think of a more clever way to multiply</span></span>
<span id="cb11-6"><a href="data-quality-assessments.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#chl_a by the range of values, so just made</span></span>
<span id="cb11-7"><a href="data-quality-assessments.html#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe 4 times bigger with new column called ratio. </span></span>
<span id="cb11-8"><a href="data-quality-assessments.html#cb11-8" aria-hidden="true" tabindex="-1"></a>nap_test <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(in_vis,<span class="at">chl_ratio =</span> range) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="data-quality-assessments.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chl_a_biomass =</span> (chl_a<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">*</span>chl_ratio,</span>
<span id="cb11-10"><a href="data-quality-assessments.html#cb11-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">tss_dead =</span> tss<span class="sc">-</span>chl_a_biomass)</span></code></pre></div>
</div>
<div id="simple-evaluations-of-conversion" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Simple evaluations of conversion</h3>
<div id="negative-tss_dead" class="section level4" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Negative tss_dead</h4>
<p>Probably the simplest way to see which ratios are more appropriate is to
look at how that impacts how many tss_dead observations are negative (impossible).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-quality-assessments.html#cb12-1" aria-hidden="true" tabindex="-1"></a>nap_test <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="data-quality-assessments.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">negative =</span> <span class="fu">ifelse</span>(tss_dead <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">&#39;neg&#39;</span>, <span class="st">&#39;pos&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="data-quality-assessments.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(negative,chl_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="data-quality-assessments.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="data-quality-assessments.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&#39;negative&#39;</span>,<span class="at">values_from =</span> <span class="st">&#39;n&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="data-quality-assessments.html#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent_neg =</span> neg<span class="sc">/</span>(pos<span class="sc">+</span>neg)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="data-quality-assessments.html#cb12-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">chl_ratio</th>
<th align="right">neg</th>
<th align="right">pos</th>
<th align="right">percent_neg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">10</td>
<td align="right">4</td>
<td align="right">100819</td>
<td align="right">0.0039673</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">33</td>
<td align="right">100790</td>
<td align="right">0.0327306</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">955</td>
<td align="right">99868</td>
<td align="right">0.9472045</td>
</tr>
<tr class="even">
<td align="right">200</td>
<td align="right">5125</td>
<td align="right">95698</td>
<td align="right">5.0831655</td>
</tr>
</tbody>
</table>
<p>Well, that sort of produces obvious results. Smaller ratios mean, less negative
NAP estimates, but there is a big increase between 100-200, making me think the
“correct” ratio may be in there somewhere.</p>
</div>
<div id="relationship-between-chl-a-and-tss_dead" class="section level4" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Relationship between chl-a and tss_dead</h4>
<p>If you recall from the previous section, there was a strong linear
relationship between chl-a and tss across all sites and water types (r2 &gt; 0.35).
One effect we’d expect to see with the tss_dead estimate is that this relationship
should decay. While there are reasons for chl-a to be correlated with tss (sediment
brings nutrients for example), chl-a also includes algal cells which are suspended
particles themselves. If this approach worked well, we should see weaker relationships
between tss_dead and chl-a</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-quality-assessments.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subset for plotting purposes</span></span>
<span id="cb13-2"><a href="data-quality-assessments.html#cb13-2" aria-hidden="true" tabindex="-1"></a>nap_test <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="data-quality-assessments.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Remove negatives and very small numbers (ug/L of sediment is basically zero)</span></span>
<span id="cb13-4"><a href="data-quality-assessments.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tss_dead <span class="sc">&gt;</span> <span class="fl">0.001</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="data-quality-assessments.html#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="data-quality-assessments.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(., <span class="fu">aes</span>(chl_a,tss_dead,<span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb13-7"><a href="data-quality-assessments.html#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>chl_ratio) <span class="sc">+</span> </span>
<span id="cb13-8"><a href="data-quality-assessments.html#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb13-9"><a href="data-quality-assessments.html#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb13-10"><a href="data-quality-assessments.html#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb13-11"><a href="data-quality-assessments.html#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_poly_eq</span>() <span class="sc">+</span> </span>
<span id="cb13-12"><a href="data-quality-assessments.html#cb13-12" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb13-13"><a href="data-quality-assessments.html#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;seagreen3&#39;</span>,<span class="st">&#39;skyblue3&#39;</span>,<span class="st">&#39;saddlebrown&#39;</span>)) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="Light-Partitioning_files/figure-html/unnamed-chunk-9-1.png" alt="At low chl_ratios (10/20), there is really no change to the correlation between tss and chl_a, but at higher ratios (100/200), the relationship does breakdown some, though not completely" width="672" />
<p class="caption">
Figure 3.1: At low chl_ratios (10/20), there is really no change to the correlation between tss and chl_a, but at higher ratios (100/200), the relationship does breakdown some, though not completely
</p>
</div>
<ul>
<li>What to do with this?</li>
<li>I prefer just 100 going forward. Mostly goldilocks preference tho</li>
</ul>
</div>
</div>
</div>
<div id="data-driven-qaqc" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Data-driven qa/qc</h2>
<p>We know that data in the water quality portal (and therfore in aquasat) comes
with inherent biases and problems that are a natural part of aggregated massive
datasets like the WQP. So how do we evaluate data quality in this context? Here
we assume that some answers about data quality can be found in the original
WQP data context including analytical and field methods data as well as
information about which organizations collected the sample.</p>
<p>The sketchy part? We don’t have a systematic way to understand if data is unreliable
except for… The contributions of each our constituents to clarity should be limited
by physical limits of how light interacts with particles, algae, and DOC. So if
we build a model of light extinction as a function of f(doc, chl_a, tss_dead), the
worst residuals on that model, might inform data quality. Then we can subset data
to only include data of the highest quality.</p>
<div id="extracting-methods" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Extracting methods</h3>
<p>AquaSat chose (I) to remove methods info from the raw wqp data, but we kept it
in a second file that we already downloaded. We just need to manipulate that data
to play nice with our simultaneous observation data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-quality-assessments.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This chunk is slow and therefore not run in bookdown. </span></span>
<span id="cb14-2"><a href="data-quality-assessments.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="data-quality-assessments.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#get WQP methods for post-hoc investigation of errors</span></span>
<span id="cb14-4"><a href="data-quality-assessments.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="data-quality-assessments.html#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="data-quality-assessments.html#cb14-6" aria-hidden="true" tabindex="-1"></a>simul_methods <span class="ot">&lt;-</span>  data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&#39;data/in/aq_situ/in-situ/wqp_long_with_methods.csv&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="data-quality-assessments.html#cb14-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(SiteID <span class="sc">%in%</span> in_vis<span class="sc">$</span>SiteID)</span>
<span id="cb14-8"><a href="data-quality-assessments.html#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="data-quality-assessments.html#cb14-9" aria-hidden="true" tabindex="-1"></a>simul_methods_time_fix <span class="ot">&lt;-</span> simul_methods <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="data-quality-assessments.html#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">as.character</span>(<span class="fu">format</span>(date_time, <span class="st">&#39;%H:%M:%S&#39;</span>)), </span>
<span id="cb14-11"><a href="data-quality-assessments.html#cb14-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_only=</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(date_time) <span class="sc">|</span> time <span class="sc">==</span> <span class="st">&#39;00:00:00&#39;</span>,T,F), </span>
<span id="cb14-12"><a href="data-quality-assessments.html#cb14-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_unity =</span> <span class="fu">ymd_hms</span>(<span class="fu">ifelse</span>(date_only <span class="sc">==</span> T,</span>
<span id="cb14-13"><a href="data-quality-assessments.html#cb14-13" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">paste</span>(date,<span class="st">&#39;12:00:00&#39;</span>),</span>
<span id="cb14-14"><a href="data-quality-assessments.html#cb14-14" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">as.character</span>(date_time)),</span>
<span id="cb14-15"><a href="data-quality-assessments.html#cb14-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">tz=</span><span class="st">&#39;UTC&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-16"><a href="data-quality-assessments.html#cb14-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">as.character</span>(<span class="fu">format</span>(date_unity, <span class="st">&#39;%H:%M:%S&#39;</span>)),</span>
<span id="cb14-17"><a href="data-quality-assessments.html#cb14-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_unity =</span> <span class="fu">ifelse</span>(time <span class="sc">==</span> <span class="st">&#39;00:00:00&#39;</span>,</span>
<span id="cb14-18"><a href="data-quality-assessments.html#cb14-18" aria-hidden="true" tabindex="-1"></a>          date_unity <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">12</span>),</span>
<span id="cb14-19"><a href="data-quality-assessments.html#cb14-19" aria-hidden="true" tabindex="-1"></a>          date_unity) <span class="sc">%&gt;%</span> <span class="co">#Convert back to poxict ()</span></span>
<span id="cb14-20"><a href="data-quality-assessments.html#cb14-20" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as.POSIXct</span>(.,<span class="at">origin=</span><span class="st">&#39;1970-01-01 00:00:00&#39;</span>,<span class="at">tz=</span><span class="st">&#39;UTC&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-21"><a href="data-quality-assessments.html#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#remove any time stamps that are NA</span></span>
<span id="cb14-22"><a href="data-quality-assessments.html#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date_unity)) <span class="sc">%&gt;%</span></span>
<span id="cb14-23"><a href="data-quality-assessments.html#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(date_unity) <span class="sc">&gt;</span> <span class="dv">1900</span>,</span>
<span id="cb14-24"><a href="data-quality-assessments.html#cb14-24" aria-hidden="true" tabindex="-1"></a>         <span class="fu">year</span>(date_unity) <span class="sc">&lt;=</span> <span class="fu">year</span>(<span class="fu">Sys.Date</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb14-25"><a href="data-quality-assessments.html#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select(SiteID,date,characteristicName) %&gt;%</span></span>
<span id="cb14-26"><a href="data-quality-assessments.html#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-27"><a href="data-quality-assessments.html#cb14-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date_only) <span class="sc">%&gt;%</span></span>
<span id="cb14-28"><a href="data-quality-assessments.html#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">harmonized_parameter =</span> <span class="fu">gsub</span>(<span class="st">&#39;chl.a&#39;</span>,<span class="st">&#39;chl_a&#39;</span>,harmonized_parameter))</span>
<span id="cb14-29"><a href="data-quality-assessments.html#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="data-quality-assessments.html#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="data-quality-assessments.html#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="data-quality-assessments.html#cb14-32" aria-hidden="true" tabindex="-1"></a>simul_vis_long <span class="ot">&lt;-</span> in_vis <span class="sc">%&gt;%</span></span>
<span id="cb14-33"><a href="data-quality-assessments.html#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> chl_a<span class="sc">:</span>tss,<span class="at">names_to =</span> <span class="st">&#39;harmonized_parameter&#39;</span>) </span>
<span id="cb14-34"><a href="data-quality-assessments.html#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="data-quality-assessments.html#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="data-quality-assessments.html#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="data-quality-assessments.html#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="data-quality-assessments.html#cb14-38" aria-hidden="true" tabindex="-1"></a>simul_vis_methods <span class="ot">&lt;-</span> <span class="fu">full_join</span>(simul_methods_time_fix,simul_vis_long) </span>
<span id="cb14-39"><a href="data-quality-assessments.html#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="data-quality-assessments.html#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="data-quality-assessments.html#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co">#Fast</span></span>
<span id="cb14-42"><a href="data-quality-assessments.html#cb14-42" aria-hidden="true" tabindex="-1"></a>feather<span class="sc">::</span><span class="fu">write_feather</span>(simul_vis_methods, <span class="st">&#39;data/out/simul_methods.feather&#39;</span>)</span>
<span id="cb14-43"><a href="data-quality-assessments.html#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproducible</span></span>
<span id="cb14-44"><a href="data-quality-assessments.html#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(simul_vis_methods,<span class="st">&#39;data/out/simul_methods.csv&#39;</span>)</span></code></pre></div>
</div>
<div id="light-attenuation-model-and-residuals" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Light attenuation model and residuals</h3>
<p>Model assumptions</p>
<ul>
<li><p>Not searching for intercept assuming observed 0.15 coefficient for intercept (pure water attenuation)</p></li>
<li><p>For now, not doing the middle 2.5-97.5% of data, can add back in.</p></li>
<li><p>Normality assumptions aren’t fully met</p></li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-quality-assessments.html#cb15-1" aria-hidden="true" tabindex="-1"></a>nap_100 <span class="ot">&lt;-</span> nap_test <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="data-quality-assessments.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(chl_ratio <span class="sc">==</span> <span class="dv">100</span>,</span>
<span id="cb15-3"><a href="data-quality-assessments.html#cb15-3" aria-hidden="true" tabindex="-1"></a>         tss_dead <span class="sc">&gt;</span> <span class="fl">0.001</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="data-quality-assessments.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">secchi =</span> <span class="fu">ifelse</span>(secchi <span class="sc">&lt;</span> <span class="fl">0.01</span>,<span class="fl">0.01</span>,secchi),</span>
<span id="cb15-5"><a href="data-quality-assessments.html#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">kd =</span> (<span class="fl">1.4</span><span class="sc">/</span>(secchi))) </span>
<span id="cb15-6"><a href="data-quality-assessments.html#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="data-quality-assessments.html#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="data-quality-assessments.html#cb15-8" aria-hidden="true" tabindex="-1"></a>k_w <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">1.5</span><span class="sc">/</span><span class="fu">max</span>(nap_100<span class="sc">$</span>secchi)</span>
<span id="cb15-9"><a href="data-quality-assessments.html#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="data-quality-assessments.html#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="data-quality-assessments.html#cb15-11" aria-hidden="true" tabindex="-1"></a>kd_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>((kd<span class="sc">-</span>k_w)  <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span>tss_dead <span class="sc">+</span> doc <span class="sc">+</span> chl_a, <span class="at">data =</span> nap_100)</span>
<span id="cb15-12"><a href="data-quality-assessments.html#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="data-quality-assessments.html#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="data-quality-assessments.html#cb15-14" aria-hidden="true" tabindex="-1"></a>nap_100<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(kd_mod,nap_100) <span class="sc">+</span> k_w</span>
<span id="cb15-15"><a href="data-quality-assessments.html#cb15-15" aria-hidden="true" tabindex="-1"></a>nap_100<span class="sc">$</span>residuals <span class="ot">&lt;-</span> (nap_100<span class="sc">$</span>kd <span class="sc">-</span> nap_100<span class="sc">$</span>pred)</span>
<span id="cb15-16"><a href="data-quality-assessments.html#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="data-quality-assessments.html#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="data-quality-assessments.html#cb15-18" aria-hidden="true" tabindex="-1"></a>nap_100 <span class="sc">%&gt;%</span></span>
<span id="cb15-19"><a href="data-quality-assessments.html#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-20"><a href="data-quality-assessments.html#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(kd,pred)) <span class="sc">+</span> </span>
<span id="cb15-21"><a href="data-quality-assessments.html#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb15-22"><a href="data-quality-assessments.html#cb15-22" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb15-23"><a href="data-quality-assessments.html#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;kd (1.4/secchi)&#39;</span>) <span class="sc">+</span></span>
<span id="cb15-24"><a href="data-quality-assessments.html#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;predicted kd&#39;</span>) <span class="sc">+</span></span>
<span id="cb15-25"><a href="data-quality-assessments.html#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb15-26"><a href="data-quality-assessments.html#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb15-27"><a href="data-quality-assessments.html#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>,<span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb15-28"><a href="data-quality-assessments.html#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="Light-Partitioning_files/figure-html/unnamed-chunk-11-1.png" alt="modelled light extinction coefficient versus observed, red line is 1:1 line and blue is line of best fit" width="672" />
<p class="caption">
Figure 3.2: modelled light extinction coefficient versus observed, red line is 1:1 line and blue is line of best fit
</p>
</div>
</div>
<div id="systematic-problems" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Systematic problems?</h3>
<div id="chl-a-methods" class="section level4" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Chl-a methods</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-quality-assessments.html#cb17-1" aria-hidden="true" tabindex="-1"></a>simul_vis_methods <span class="ot">&lt;-</span> feather<span class="sc">::</span><span class="fu">read_feather</span>(<span class="st">&#39;data/out/simul_methods.feather&#39;</span>)</span>
<span id="cb17-2"><a href="data-quality-assessments.html#cb17-2" aria-hidden="true" tabindex="-1"></a>methods_summarizer <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">param =</span> <span class="st">&#39;chl_a&#39;</span>){</span>
<span id="cb17-3"><a href="data-quality-assessments.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="data-quality-assessments.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  methods <span class="ot">&lt;-</span> simul_vis_methods <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="data-quality-assessments.html#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(harmonized_parameter <span class="sc">==</span> param) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="data-quality-assessments.html#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(nap_100 <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="data-quality-assessments.html#cb17-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(SiteID,date_unity,residuals,pred,kd)) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="data-quality-assessments.html#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(characteristicName))</span>
<span id="cb17-9"><a href="data-quality-assessments.html#cb17-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-10"><a href="data-quality-assessments.html#cb17-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-11"><a href="data-quality-assessments.html#cb17-11" aria-hidden="true" tabindex="-1"></a>  method_plot <span class="ot">&lt;-</span> methods <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="data-quality-assessments.html#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(analytical_method) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="data-quality-assessments.html#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="data-quality-assessments.html#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">method_count =</span> <span class="fu">paste</span>(<span class="st">&#39;n =&#39;</span>,n,<span class="st">&#39;-&#39;</span>,analytical_method)) <span class="sc">%&gt;%</span></span>
<span id="cb17-15"><a href="data-quality-assessments.html#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(., <span class="fu">aes</span>(kd,pred,<span class="at">color =</span> method_count)) <span class="sc">+</span> </span>
<span id="cb17-16"><a href="data-quality-assessments.html#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point(shape = 1) + </span></span>
<span id="cb17-17"><a href="data-quality-assessments.html#cb17-17" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb17-18"><a href="data-quality-assessments.html#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&#39;kd (1.4/secchi)&#39;</span>) <span class="sc">+</span></span>
<span id="cb17-19"><a href="data-quality-assessments.html#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;predicted kd&#39;</span>) <span class="sc">+</span></span>
<span id="cb17-20"><a href="data-quality-assessments.html#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb17-21"><a href="data-quality-assessments.html#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb17-22"><a href="data-quality-assessments.html#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>,<span class="at">se=</span>F) <span class="sc">+</span></span>
<span id="cb17-23"><a href="data-quality-assessments.html#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb17-24"><a href="data-quality-assessments.html#cb17-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-25"><a href="data-quality-assessments.html#cb17-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-26"><a href="data-quality-assessments.html#cb17-26" aria-hidden="true" tabindex="-1"></a>  method_error <span class="ot">&lt;-</span> methods <span class="sc">%&gt;%</span></span>
<span id="cb17-27"><a href="data-quality-assessments.html#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(analytical_method) <span class="sc">%&gt;%</span></span>
<span id="cb17-28"><a href="data-quality-assessments.html#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">rmse =</span> <span class="fu">rmse</span>(kd,pred),</span>
<span id="cb17-29"><a href="data-quality-assessments.html#cb17-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb17-30"><a href="data-quality-assessments.html#cb17-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-31"><a href="data-quality-assessments.html#cb17-31" aria-hidden="true" tabindex="-1"></a>  name_error <span class="ot">&lt;-</span> methods <span class="sc">%&gt;%</span></span>
<span id="cb17-32"><a href="data-quality-assessments.html#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(characteristicName) <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="data-quality-assessments.html#cb17-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">rmse =</span> <span class="fu">rmse</span>(kd,pred),</span>
<span id="cb17-34"><a href="data-quality-assessments.html#cb17-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb17-35"><a href="data-quality-assessments.html#cb17-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-36"><a href="data-quality-assessments.html#cb17-36" aria-hidden="true" tabindex="-1"></a>  name_plot <span class="ot">&lt;-</span> methods <span class="sc">%&gt;%</span></span>
<span id="cb17-37"><a href="data-quality-assessments.html#cb17-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(characteristicName) <span class="sc">%&gt;%</span></span>
<span id="cb17-38"><a href="data-quality-assessments.html#cb17-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-39"><a href="data-quality-assessments.html#cb17-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">name_count =</span> <span class="fu">paste</span>(<span class="st">&#39;n =&#39;</span>,n,<span class="st">&#39;-&#39;</span>,characteristicName)) <span class="sc">%&gt;%</span></span>
<span id="cb17-40"><a href="data-quality-assessments.html#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(., <span class="fu">aes</span>(kd,pred,<span class="at">color =</span> name_count)) <span class="sc">+</span> </span>
<span id="cb17-41"><a href="data-quality-assessments.html#cb17-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point(shape = 1) + </span></span>
<span id="cb17-42"><a href="data-quality-assessments.html#cb17-42" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb17-43"><a href="data-quality-assessments.html#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&#39;kd (1.4/secchi)&#39;</span>) <span class="sc">+</span></span>
<span id="cb17-44"><a href="data-quality-assessments.html#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;predicted kd&#39;</span>) <span class="sc">+</span></span>
<span id="cb17-45"><a href="data-quality-assessments.html#cb17-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb17-46"><a href="data-quality-assessments.html#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb17-47"><a href="data-quality-assessments.html#cb17-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>,<span class="at">se=</span>F) <span class="sc">+</span></span>
<span id="cb17-48"><a href="data-quality-assessments.html#cb17-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>)</span>
<span id="cb17-49"><a href="data-quality-assessments.html#cb17-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-50"><a href="data-quality-assessments.html#cb17-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(method_error,name_error,method_plot,name_plot))</span>
<span id="cb17-51"><a href="data-quality-assessments.html#cb17-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-52"><a href="data-quality-assessments.html#cb17-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-53"><a href="data-quality-assessments.html#cb17-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-54"><a href="data-quality-assessments.html#cb17-54" aria-hidden="true" tabindex="-1"></a>chl_errors <span class="ot">&lt;-</span> <span class="fu">methods_summarizer</span>(<span class="st">&#39;chl_a&#39;</span>)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;SiteID&quot;, &quot;date_unity&quot;)</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-quality-assessments.html#cb19-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(chl_errors[[<span class="dv">1</span>]])</span></code></pre></div>
<table>
<colgroup>
<col width="79%" />
<col width="13%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">analytical_method</th>
<th align="right">rmse</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">10200 H ~ Chlorophyll a-b-c Determination</td>
<td align="right">1.9266312</td>
<td align="right">24831</td>
</tr>
<tr class="even">
<td align="left">10200 H 2 ~ Chlorophyll a-b-c Determination by spectrophotometer</td>
<td align="right">0.4049297</td>
<td align="right">81</td>
</tr>
<tr class="odd">
<td align="left">CHLOROPHYLL-A UG/L SPECTROPHOTOMETRIC ACID. METH.</td>
<td align="right">0.4629188</td>
<td align="right">48</td>
</tr>
<tr class="even">
<td align="left">Chlorophyll a-b-c- Determination</td>
<td align="right">1.2748053</td>
<td align="right">42</td>
</tr>
<tr class="odd">
<td align="left">Chlorophyll a, phytoplankton</td>
<td align="right">1.2370405</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Chlorophyll a,phyto,fluorometric</td>
<td align="right">4.5644898</td>
<td align="right">227</td>
</tr>
<tr class="odd">
<td align="left">Chlorophyll via HPLC / Spectrophotometer</td>
<td align="right">4.4348321</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Chlorophyll, phytoplankton, HPLC</td>
<td align="right">2.3996726</td>
<td align="right">318</td>
</tr>
<tr class="odd">
<td align="left">FLUOROMETIC CHLOROPHYLL USING PROBE</td>
<td align="right">0.5824996</td>
<td align="right">184</td>
</tr>
<tr class="even">
<td align="left">FLUOROMETRIC; IN-VITRO CHLOROPHYLL A</td>
<td align="right">0.5054935</td>
<td align="right">41</td>
</tr>
<tr class="odd">
<td align="left">In-Vitro Determination of Chlorophyll</td>
<td align="right">2.4017753</td>
<td align="right">14935</td>
</tr>
<tr class="even">
<td align="left">L01</td>
<td align="right">1.9321800</td>
<td align="right">386</td>
</tr>
<tr class="odd">
<td align="left">L02</td>
<td align="right">13.3706748</td>
<td align="right">109</td>
</tr>
<tr class="even">
<td align="left">Laboratory Procedures for Water Quality Chemical Analysis</td>
<td align="right">4.0442985</td>
<td align="right">53</td>
</tr>
<tr class="odd">
<td align="left">MONOCHROMATIC; SPECTROPHOTOMETRIC</td>
<td align="right">3.3916554</td>
<td align="right">36439</td>
</tr>
<tr class="even">
<td align="left">Pigments, algae, EPA445.0 w/ACTN</td>
<td align="right">2.8380136</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">SM10200H</td>
<td align="right">5.1510739</td>
<td align="right">233</td>
</tr>
<tr class="even">
<td align="left">STANDARD METHOD FOR 10200 H</td>
<td align="right">1.4953379</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">2.7106937</td>
<td align="right">17740</td>
</tr>
</tbody>
</table>
</div>
<div id="chl-a-names" class="section level4" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Chl-a names</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-quality-assessments.html#cb20-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(chl_errors[[<span class="dv">2</span>]])</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">characteristicName</th>
<th align="right">rmse</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Chlorophyll a</td>
<td align="right">2.977341</td>
<td align="right">79683</td>
</tr>
<tr class="even">
<td align="left">Chlorophyll a (probe relative fluorescence)</td>
<td align="right">2.345192</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">Chlorophyll a (probe)</td>
<td align="right">11.662752</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">Chlorophyll a, corrected for pheophytin</td>
<td align="right">1.844879</td>
<td align="right">15951</td>
</tr>
<tr class="odd">
<td align="left">Chlorophyll a, free of pheophytin</td>
<td align="right">3.205955</td>
<td align="right">6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="download-and-join.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
